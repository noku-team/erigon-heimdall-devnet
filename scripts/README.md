# Convert Priv Validator Key to Ethereum Address

## Description

`convert_priv_val.py` is a Python script that converts a public key contained in a `priv_validator_key` JSON file into two main outputs:

- **pubKey**: The public key in hexadecimal format with a `0x` prefix.
- **signer**: The Ethereum address derived from the public key using the Keccak-256 hash.

## Prerequisites

- Python 3.x

To install dependencies:

```bash
pip install -r requirements.txt
```

## Usage

### 1. Input JSON File Format

The JSON file must have the following structure:

```json
{
  "address": "048D975E40D9D9E8931B9EC38F404B8E36BE3218",
  "pub_key": {
    "type": "tendermint/PubKeySecp256k1",
    "value": "BDJF1m78p5iGCI4+RUprEqeAipRBVmokpJ2wYoR9ipdXNO9sgdn9FLU/TPRJn61REchsmRNyXnuTmXeHX91scSw="
  },
  "priv_key": {
    "type": "tendermint/PrivKeySecp256k1",
    "value": "<BASE_64>"
  }
}
```

- **`pub_key.value`**: Must be encoded in Base64.

### 2. Running the Script

Run the script by specifying the path to the JSON file as a parameter:

```bash
python convert_priv_val.py <path_to_json_file>
```

### 3. Output

The script prints a JSON object with the following fields:

- **`pubKey`**: The public key converted into hexadecimal format.
- **`signer`**: The Ethereum address derived from the public key.

#### Example Output

```json
{
    "pubKey": "0x042425d66efca79886088e3e454a6b12a7808a9441566a24a49db062847d8a975734ef6c81d9fd14b53f4cf4499fad5111c86c9913725e7b939977875fdd6c712c",
    "signer": "0x048d975e40d9d9e8931b9ec38f404b8e36be3218"
}
```

## Technical Notes

1. **Base64 Decoding**: The public key is first decoded from Base64 into bytes.
2. **Hexadecimal Conversion**: The bytes are converted into hexadecimal format with a `0x` prefix.
3. **Ethereum Address Calculation**:
   - The first byte of the public key is removed (compression indicator).
   - The Keccak-256 hash is computed on the remaining bytes.
   - The last 20 bytes of the hash are used as the Ethereum address.

## Error Handling

The script handles the following errors:

- **File Not Found**: Displays an error message if the specified JSON file does not exist.
- **Missing Keys**: Notifies if required fields are missing in the JSON file.
- **General Errors**: Prints error details to facilitate debugging.

## Example Command

```bash
python convert_priv_val.py priv_validator_key.json
```

---

# Polygon Validator Setup Tool

This tool simplifies the setup of validators for a Polygon network by converting private keys from the Heimdall format to the format required by Bor.

## Prerequisites

- Python 3.6 or later
- `priv_validator_key.json` file generated by Heimdall
- Bor installed on the system

## Installation

1. Clone or download this repository.
2. No additional Python dependencies are required.

## Usage

### 1. Preparation

Ensure you have the `priv_validator_key.json` file generated by Heimdall. This file typically has the following structure:

```json
{
  "address": "YOUR_VALIDATOR_ADDRESS",
  "pub_key": {
    "type": "tendermint/PubKeySecp256k1",
    "value": "BASE64_ENCODED_PUBLIC_KEY"
  },
  "priv_key": {
    "type": "tendermint/PrivKeySecp256k1",
    "value": "BASE64_ENCODED_PRIVATE_KEY"
  }
}
```

### 2. Key Conversion

Run the script by passing the path to the JSON file:

```bash
python convert_key.py path/to/priv_validator_key.json
```

The script:

- Reads the JSON file.
- Converts the private key from Base64 to hexadecimal format.
- Creates a `privatekey.txt` file with the converted key.
- Displays the validator's address.
- Generates the necessary commands for configuring Bor.

### 3. Bor Configuration

#### 1. Create a `password.txt` file with a secure password

```bash
echo "your_secure_password" > password.txt
```

#### 2. Import the private key into Bor using the command generated by the script

```bash
./bin/bor account import -datadir ./erigon_data/bor_datadir_1 scripts/out/privatekey.txt
```

#### 3. Delete the `privatekey.txt` file

```bash
rm out/privatekey.txt
```

#### 4. Start Bor using the full command generated by the script

```bash
./bin/bor \
  --datadir ./erigon_data/bor_datadir_1 \
  --chain ./erigon_data/genesis.json \
  --mine \
  --miner.validator "0xYOUR_VALIDATOR_ADDRESS" \
  --miner.gaslimit "30000000" \
  --unlock "0xYOUR_VALIDATOR_ADDRESS" \
  --password password.txt \
  --allow-insecure-unlock
```

## Security Notes

- Never share or expose private keys.
- Delete the `privatekey.txt` file immediately after import.
- Keep the `password.txt` file secure.
- Use different passwords for each validator.
- Consider using a key management system in production.

## File Structure

```bash
.
├── set_bor_pk.py        # Main script
├── password.txt         # Password file (to be created)
└── SET_BOR.md           # This file
```
